<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Security Camera Dashboard</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; margin: 16px; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 12px; max-width: 720px; }
    input { width: 100%; padding: 10px; margin: 6px 0; }
    button { padding: 10px 12px; cursor: pointer; }
    #log { white-space: pre-wrap; font-family: ui-monospace, Menlo, monospace; font-size: 12px; margin-top: 12px; }
    .ok { color: #0a7; } .bad { color: #c00; }
  </style>
</head>
<body>
  <h2>Security Camera - MQTT Events</h2>

  <div class="card">
    <div><b>Host</b> (fixed):</div>
    <input id="host" value="a1326901dd494c3bb89746fcd9d4bf98.s1.eu.hivemq.cloud" />

    <div><b>Username</b> :</div>
    <input id="user" placeholder="dashboard_viewer" />

    <div><b>Password</b>:</div>
    <input id="pass" type="password" placeholder="your password" />

    <div><b>Subscribe topic</b>:</div>
    <input id="topic" value="gd/+/event" />

    <button id="btn">Connect</button>
    <div id="status" class="bad">Disconnected</div>

    <div id="log"></div>
  </div>

  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
  <script>
    let client = null;

    const el = (id) => document.getElementById(id);
    const setStatus = (ok, text) => {
      el('status').className = ok ? 'ok' : 'bad';
      el('status').textContent = text;
    };
    const log = (line) => {
      el('log').textContent = line + "\n" + el('log').textContent;
    };

    el('btn').onclick = () => {
      if (client) {
        client.end(true);
        client = null;
        setStatus(false, "Disconnected");
        el('btn').textContent = "Connect";
        return;
      }

      const host = el('host').value.trim();
      const username = el('user').value.trim();
      const password = el('pass').value;
      const topic = el('topic').value.trim();

      // HiveMQ Cloud supports MQTT over WebSocket on port 8884 (encrypted WSS). :contentReference[oaicite:3]{index=3}
      const url = `wss://${host}:8884/mqtt`;

      client = mqtt.connect(url, {
        username,
        password,
        clean: true,
        connectTimeout: 8000,
        reconnectPeriod: 2000,
      });

      setStatus(false, "Connectingâ€¦");

      client.on('connect', () => {
        setStatus(true, "Connected");
        el('btn').textContent = "Disconnect";
        log(`[CONNECT] ${new Date().toISOString()}`);

        client.subscribe(topic, { qos: 0 }, (err) => {
          if (err) log(`[SUB ERR] ${err.message}`);
          else log(`[SUB] ${topic}`);
        });
      });

      client.on('message', (t, payload) => {
        log(`[MSG] ${new Date().toISOString()} ${t} ${payload.toString()}`);
      });

      client.on('error', (e) => log(`[ERROR] ${e.message}`));
      client.on('close', () => {
        setStatus(false, "Disconnected");
        el('btn').textContent = "Connect";
        client = null;
      });
    };
  </script>
</body>
</html>
